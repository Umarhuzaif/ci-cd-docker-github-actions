<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CI/CD Pipeline Dashboard</title>

  <!-- CSS (cache-busted with python version/env vars you already pass) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ python_version }}">

  <!-- Chart.js for the 5-min CPU/Mem line chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>

  <!-- Expose a couple of server values to JS -->
  <script>
    window.APP_ENV = "{{ app_env }}";
    window.PY_VERSION = "{{ python_version }}";
    window.HOSTNAME  = "{{ host }}";
  </script>

  <!-- JS (cache-busted) -->
  <script src="{{ url_for('static', filename='js/app.js') }}?v={{ python_version }}" defer></script>
</head>
<body>
  <main class="container">
    <header class="header">
      <h1>CI/CD Pipeline Dashboard</h1>
      <div class="header-controls">
        <div class="refresh">
          <span>Auto refresh</span>
          <button class="chip" data-interval="5">5s</button>
          <button class="chip" data-interval="10">10s</button>
          <button class="chip" data-interval="30">30s</button>
        </div>
        <div class="toggles">
          <label class="switch">
            <input id="darkToggle" type="checkbox">
            <span class="slider"></span>
          </label>
          <span class="env-badge" id="envBadge">PROD</span>
        </div>
      </div>
    </header>

    <section class="grid">
      <!-- Pipeline Stages -->
      <div class="card">
        <div class="card-title">Pipeline Stages</div>
        <ul class="stages">
          <li><span class="dot" id="dotBuild"></span> Build <span id="stageBuild" class="muted">—</span></li>
          <li><span class="dot" id="dotTest"></span> Test <span id="stageTest" class="muted">—</span></li>
          <li><span class="dot" id="dotDeploy"></span> Deploy <span id="stageDeploy" class="muted">—</span></li>
        </ul>
      </div>

      <!-- Server Status -->
      <div class="card">
        <div class="card-title">Server Status</div>
        <div class="status-row">
          <span id="serverBadge" class="badge">—</span>
          <span id="serverNote" class="muted">—</span>
        </div>
        <div class="kv">
          <div><span>Uptime</span><strong id="uptime">—</strong></div>
          <div><span>Requests served</span><strong id="served">—</strong></div>
        </div>
      </div>

      <!-- Git Info -->
      <div class="card">
        <div class="card-title">Git Info</div>
        <div class="kv">
          <div><span>Branch</span><strong id="gitBranch">—</strong></div>
          <div><span>Commit</span><strong id="gitCommit">—</strong></div>
          <div><span>Author</span><strong id="gitAuthor">—</strong></div>
          <div><span>Last commit</span><strong id="gitDate">—</strong></div>
        </div>
      </div>

      <!-- Resource Usage (current) -->
      <div class="card">
        <div class="card-title">Resource Usage</div>
        <div class="bars">
          <div class="bar">
            <span>CPU</span>
            <div class="bar-rail"><div id="cpuBar" class="bar-fill" style="width:0%"></div></div>
            <span id="cpuPct" class="mono">—</span>
          </div>
          <div class="bar">
            <span>Memory</span>
            <div class="bar-rail"><div id="memBar" class="bar-fill" style="width:0%"></div></div>
            <span id="memPct" class="mono">—</span>
          </div>
          <p class="help">If CPU/Memory show “–”, host metrics aren’t available (that’s okay in some hosts).</p>
        </div>
      </div>

      <!-- Container Info -->
      <div class="card">
        <div class="card-title">Container Info</div>
        <div class="kv">
          <div><span>Container ID</span><strong id="cid">—</strong></div>
          <div><span>Uptime</span><strong id="cuptime">—</strong></div>
          <div><span>Port mappings</span><strong id="ports">—</strong></div>
        </div>
      </div>

      <!-- Resource Usage (5m chart) -->
      <div class="card">
        <div class="card-title">Resource Usage (5m)</div>
        <div style="height:160px">
          <canvas id="usageChart"></canvas>
        </div>
      </div>

      <!-- System Info -->
      <div class="card">
        <div class="card-title">System Info</div>
        <div class="kv">
          <div><span>Host</span><strong id="sysHost">—</strong></div>
          <div><span>Python</span><strong id="sysPy">—</strong></div>
          <div><span>UTC Time</span><strong id="sysUtc">—</strong></div>
        </div>
        <p class="muted small">This page calls <code>/api/health</code> every 5s.</p>
      </div>

      <!-- Recent Logs (optional) -->
      <div class="card" id="logsCard">
        <div class="card-title">Logs</div>
        <pre id="logs" class="logs">—</pre>
      </div>
    </section>
  </main>
</body>
</html>
